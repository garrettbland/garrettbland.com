<html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta httpequiv="Content-Type" content="text/html; charset=utf-8"><meta name="language" content="English"><meta name="robots" content="index, follow"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Adding Volume Storage to Digital Ocean Droplet</title><meta name="description" content=""><meta property="og:title" content="Adding Volume Storage to Digital Ocean Droplet"><meta property="og:site_name" content="Adding Volume Storage to Digital Ocean Droplet"><meta property="og:url" content=""><meta property="og:description" content=""><meta property="og:type" content="website"><link rel="shortcut icon" type="image/ico" href="/favicon.ico"><link rel="stylesheet" href="/style.css?v=1635015516843"></head><body x-data="darkMode" class="transition-all" x-bind:class="isDarkModeEnabled ? 'dark bg-blueGray-900' : 'bg-gray-50'"><main class="mb-24"><nav class="max-w-xl mx-auto px-4"><div class="flex justify-between items-center py-4"><a class="font-lexa relative z-20 text-xl dark:text-white font-semibold hover:underline" href="/">Garrett Bland</a><div class="flex items-center flex-row space-x-2"><button class="transform ease-in-out duration-150 hover:scale-110 origin-center p-1 hover:bg-gray-100 dark:hover:bg-blue-900 rounded-lg" x-on:click="toggleDarkMode()"><div class="relative w-8 h-8"><svg class="h-8 w-8 p-1 text-gray-700 hover:text-gray-700 dark:text-blue-50 absolute top-0 left-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" x-show="isDarkModeEnabled" x-transition.opacity="" xmlns="http://www.w3.org/2000/svg"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></path></svg> <svg class="h-8 w-8 p-1 text-gray-700 absolute top-0 left-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" x-show="!isDarkModeEnabled" x-transition.opacity="" xmlns="http://www.w3.org/2000/svg"><path d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></path></svg></div></button> <a class="transform ease-in-out duration-150 hover:scale-110 origin-center p-1 hover:bg-gray-100 dark:hover:bg-blue-900 rounded-lg" href="https://github.com/garrettbland" rel="noreferrer" target="_blank"><img alt="github-logo" class="w-8 h-8" src="/images/github.png" loading="lazy"> </a><a class="transform ease-in-out duration-150 hover:scale-110 origin-center p-1 hover:bg-gray-100 dark:hover:bg-blue-900 rounded-lg" href="https://twitter.com/gbland777" rel="noreferrer" target="_blank"><img alt="twitter-logo" class="w-8 h-8" src="/images/twitter.png" loading="lazy"></a></div></div><div class="h-px w-full bg-gradient-to-r from-transparent via-gray-200 to-transparent mb-6 dark:via-indigo-700"></div></nav><section><div><article class="prose prose-lg dark:prose-dark"><h1 class="leading-loose">Adding Volume Storage to Digital Ocean Droplet</h1><p class="flex flex-row items-center"><span class="mr-2"><svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg> </span>Posted on <time class="ml-1" datetime="2020-06-10 19:00">Jun 10, 2020</time></p><p>I use Digital Ocean for all of my server side projects. Lately I have been having some random issues start to pop up, and the culprit has always been disk space filling up.</p><p>Digital Ocean offers Volume storage you can attach to your droplets, so you can add more space without upgrading RAM and CPU. Its like adding a USB to a computer. Here are my steps to troubleshoot and add volume storage. <strong>Note that I'm not a server guy, I could be wildly wrong, but it works for me.</strong></p><p>First step, ssh into your server and run this command. It checks filesystem usage and percentages. As you can see below in my screenshot, I'm using 100% of <code>/dev/vda1</code>, not good. Another command I use is with the <code>â€”max-depth 1</code> flag. It shows the specific sizes of that directory. Very helpful to track down large log files or culprits.</p><pre><code class="language-bash">df -h
</code></pre><pre><code class="language-bash">sudo du -h  --max-depth 1
</code></pre><p><img src="/images/df_-h.png" alt="/images/df_-h.png" loading="lazy"></p><p>So I'm out of disk space and I need to add more. This is where Digital Ocean Volumes comes in. Go into your digital ocean dashboard, click on <code>Create</code>, and then choose Volume. Choose however large of size you need, choose which droplet to attach to, and then click on <code>Create Volume</code></p><p><img src="/images/digital_ocean_volume_create.png" alt="/images/digital_ocean_volume_create.png" loading="lazy"></p><p>After it creates the new volume, it will bring up a list of commands and instructions on what to do next. Most of these we will follow with a few modifications.</p><p>Since I want to continue to use my home directory for my sites, the basic process will go like this.</p><ol><li>Format our new volume so we can actually store files on it</li><li>Rename my current home directory.</li><li>Create a new mount point (directory) for that volume. In my case, I want it to be my home directory.</li><li>Mount the new volume to the new user home directory</li><li>Clone permissions from old home directory and remove all content from old directory</li><li>Move all content from the previous home directory into the new</li></ol><h3>Step 1. Format new volume</h3><p>Digital Ocean will give you this command after creating volume. If you accidentally closed it, just find your new volume and click on the down arrow and click on <code>Configure Instructions</code></p><pre><code class="language-bash">sudo mkfs.ext4 /dev/disk/by-id/scsi-0DO_Volume_volume-nyc1-01
</code></pre><h3>Step 2. Rename your desired directory</h3><p>I want to continue to use my <code>/home/forge</code> directory. I will rename <code>/home/forge</code> to <code>/home/forge-backup</code> so I can mount my new volume to <code>/home/forge</code></p><pre><code class="language-bash">mv /home/forge /home/forge-backup
</code></pre><h3>Step 3. Create a mount point for the new volume</h3><p>This is where the new volume will be mounted. I want to continue to use /home/forge, so thats what I will name my new mount point.</p><pre><code class="language-bash">mkdir -p /home/forge
</code></pre><h3>Step 4. Mount the new volume &amp; update fstab</h3><p>Now that we have our new directory created, lets mount our new volume to this directory. Make sure to replace <code>/home/forge</code> with your new directory.</p><pre><code class="language-bash">mount -o discard,defaults,noatime /dev/disk/by-id/scsi-0DO_Volume_volume-nyc1-01 /home/forge
</code></pre><p>Now change fstab so the volume will be mounted after reboot. Again, make sure to replace <code>/home/forge</code>, and <code>/dev/disk/by-id/scsi-0D0_Volume_volume-nyc1-01</code> with your own values</p><pre><code class="language-bash">echo '/dev/disk/by-id/scsi-0DO_Volume_volume-nyc1-01 /home/forge ext4 defaults,nofail,discard 0 0' | sudo tee -a /etc/fstab
</code></pre><p>After the fstab is updated, mount the drive (or reboot according to digital ocean)</p><pre><code class="language-bash">sudo mount -a
</code></pre><p>Run <code>df -h</code> again, and we should see our new volume attached and where its mounted on. As you can see, our new volume, <code>/dev/sda</code>, is mounted on <code>/home/forge</code> and has 47G available</p><p><img src="/images/df_-h_after_mount.png" alt="/images/df_-h_after_mount.png" loading="lazy"></p><h3>Step 5. Update Permissions</h3><p>Now lets update permissions from our old forge directory to our new</p><pre><code class="language-bash">sudo chown -R --reference=/home/forge-backup /home/forge
sudo chmod -R --reference=/home/forge-backup /home/forge
</code></pre><h3>Step 6. Move content into new folder</h3><p>Now that we are ready to go with our new volume attached, we can move all of our website data into our new folder. Add <code>-v</code> flag to the command to see the output as it moves files and folders.</p><pre><code class="language-bash">mv /home/forge-backup/* /home/forge/
</code></pre><p>Once its done moving, browse around in your new /home/forge directory and make sure everything looks right. If everything was moved over successfully, you can remove the old <code>/home/forge-backup</code> directory.</p><pre><code class="language-bash">rm -rf forge-backup/
</code></pre><p>Now run <code>df -h</code> again to see new disk space and availability.</p><p><img src="/images/df_-h_after_move.png" alt="/images/df_-h_after_move.png" loading="lazy"></p><h3>Success! ðŸŽ‰</h3><p>We have successfully added volume storage to our digital ocean droplet and we don't have strange error messages anymore. Go us!</p></article></div></section></main><script>function darkMode () {
            return {
                isDarkModeEnabled: false,
                init: function () {
                    console.log('Alpine ready to roll...')

                    // Watch for dark mode changing and update local storage
                    this.$watch('isDarkModeEnabled', (newValue) => {
                        console.log(`Setting dark mode in local storage to ${newValue}...`)
                        localStorage.setItem('isDarkModeEnabled', newValue)
                    })

                    // Initially grab local storage and set if local storage key is present
                    if (localStorage.getItem('isDarkModeEnabled')) {
                        this.isDarkModeEnabled = JSON.parse(localStorage.getItem('isDarkModeEnabled'))
                    }
                },
                toggleDarkMode: function () {
                    this.isDarkModeEnabled = !this.isDarkModeEnabled
                }
            }
        }</script><script src="/alpine.js?v=1635015516843"></script><script src="/prism.min.js"></script></body></html>